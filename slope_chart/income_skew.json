{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Income Distribution Skew by State (2022)",
  "width": 500,
  "height": {"step": 25},
  "data": {"url": "../hh_income_state.csv"},
  "transform": [
    {
      "filter": "year(datum.date) == 2022"
    },
    {
      "calculate": "((datum.income_mean / datum.income_median) - 1) * 100",
      "as": "gap_percentage"
    },
    {
      "fold": ["income_median", "income_mean"],
      "as": ["measure", "value"]
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "line",
        "strokeWidth": 3
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative",
          "title": "Income (RM)",
          "scale": {"zero": false},
          "axis": {"format": ",.0f"}
        },
        "y": {
          "field": "state",
          "type": "nominal",
          "title": "State",
          "sort": {
            "field": "gap_percentage",
            "order": "descending"
          }
        },
        "color": {
          "field": "gap_percentage",
          "type": "quantitative",
          "title": "Mean-Median Gap (%)",
          "scale": {
            "scheme": "orangered",
            "domainMid": 15
          }
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State"},
          {"field": "income_median", "type": "quantitative", "title": "Median Income (RM)", "format": ",.0f"},
          {"field": "income_mean", "type": "quantitative", "title": "Mean Income (RM)", "format": ",.0f"},
          {"field": "gap_percentage", "type": "quantitative", "title": "Gap (%)", "format": ".1f"}
        ]
      }
    },
    {
      "mark": {
        "type": "circle",
        "size": 100,
        "fill": "white",
        "stroke": "black",
        "strokeWidth": 1
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative"
        },
        "y": {
          "field": "state",
          "type": "nominal"
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State"},
          {"field": "measure", "type": "nominal", "title": "Measure"},
          {"field": "value", "type": "quantitative", "title": "Value (RM)", "format": ",.0f"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 5,
        "fontSize": 10
      },
      "encoding": {
        "x": {
          "field": "value",
          "type": "quantitative"
        },
        "y": {
          "field": "state",
          "type": "nominal"
        },
        "text": {
          "condition": {
            "test": "datum.measure == 'income_mean'",
            "value": "Mean"
          },
          "value": "Median"
        }
      }
    }
  ],
  "config": {
    "view": {"stroke": null},
    "axis": {"labelFontSize": 11, "titleFontSize": 12},
    "legend": {"labelFontSize": 11, "titleFontSize": 12}
  }
}