{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Real Median Income by State Over Time (Adjusted for Inflation)",
  "width": 400,
  "height": 400,
  "params": [
    {
      "name": "selectedState",
      "value": "",
      "bind": {
        "input": "select",
        "options": ["", "Johor", "Kedah", "Kelantan", "Melaka", "Negeri Sembilan", "Pahang", "Perak", "Perlis", "Pulau Pinang", "Sabah", "Sarawak", "Selangor", "Terengganu", "W.P. Kuala Lumpur", "W.P. Labuan", "W.P. Putrajaya"],
        "name": "Select State: "
      }
    }
  ],
  "data": {
    "url": "../income_cpi_analysis.csv"
  },
  "transform": [
    {
      "aggregate": [{
        "op": "mean",
        "field": "income_median_real",
        "as": "median_income_agg"
      }],
      "groupby": ["state", "year"]
    },
    {
      "calculate": "datum.median_income_agg",
      "as": "income_median_real"
    },
    {
      "window": [{
        "op": "first_value",
        "field": "median_income_agg",
        "as": "latest_income"
      }],
      "groupby": ["state"],
      "sort": [{"field": "year", "order": "descending"}]
    },
    {
      "calculate": "selectedState && datum.state === selectedState ? 2 : 0",
      "as": "strokeWidth"
    }
  ],
  "mark": {
    "type": "rect",
    "stroke": "#fff",
    "cursor": "pointer"
  },
  "encoding": {
    "y": {
      "field": "state",
      "type": "nominal",
      "sort": {"field": "latest_income", "order": "descending"},
      "title": "State"
    },
    "x": {
      "field": "year",
      "type": "ordinal",
      "title": "Year",
      "sort": [2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022]
    },
    "fill": {
      "field": "income_median_real",
      "type": "quantitative",
      "title": "Real Median Income (RM)",
      "scale": {
        "scheme": "blues",
        "domainMin": 0,
        "nice": true
      }
    },
    "tooltip": [
      {"field": "state", "type": "nominal", "title": "State"},
      {"field": "year", "type": "ordinal", "title": "Year"},
      {"field": "income_median_real", "type": "quantitative", "title": "Real Median Income (RM)", "format": ",.0f"}
    ],
    "strokeWidth": {
      "field": "strokeWidth"
    },
    "opacity": {
      "condition": {
        "test": "!selectedState || datum.state === selectedState",
        "value": 1
      },
      "value": 0.2
    }
  },
  "config": {
    "axis": {
      "grid": true
    },
    "view": {
      "stroke": "transparent"
    }
  }
}